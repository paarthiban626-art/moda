  <!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Floppy Bird Mobile</title>
<style>
html,body {
  height:100%; margin:0;
  display:flex; align-items:center; justify-content:center;
  background:#70c5ce;
  touch-action:none;
}
#gameWrapper { position:relative; }
canvas {
  background:#70c5ce; display:block;
  border:6px solid #2b6b6b; border-radius:8px;
  max-width:100vw; height:auto;
}
#overlay {
  position:absolute; left:0; top:0; right:0; bottom:0;
  display:flex; align-items:flex-start; justify-content:flex-start;
  padding:8px; color:#fff; font-weight:700; text-shadow:0 1px 0 rgba(0,0,0,0.3);
  pointer-events:none;
}
#message {
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  background:rgba(255,255,255,0.95); padding:12px 16px; border-radius:8px;
  text-align:center; display:none;
}
button {
  margin-top:8px; padding:8px 12px;
  border:none; border-radius:6px;
  background:#2b6b6b; color:#fff; font-weight:700; cursor:pointer;
}
</style>
</head>
<body>
<div id="gameWrapper">
  <canvas id="game" width="400" height="600"></canvas>
  <div id="overlay">Score: <span id="score">0</span></div>
  <div id="message">
    <div id="msgText"></div>
    <button id="startBtn">Start / Restart</button>
  </div>
</div>

<script>
(() => {
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const gravity = 0.45;
const flapStrength = -8.6;
const pipeGap = 200;
const pipeWidth = 60;
const pipeSpeed = 2.6;
const birdImageSrc = 'bird.jpg';
const flapSound = new Audio('flap.mp3');
const hitSound = new Audio('hit.mp3');

const scoreEl = document.getElementById('score');
const msgBox = document.getElementById('message');
const msgText = document.getElementById('msgText');
const startBtn = document.getElementById('startBtn');

let bird, pipes = [], running=false, score=0, bestScore=0, soundsUnlocked=false;
let lastPipeTime = 0;
const pipeInterval = 1400;
let lastFrameTime = 0;

function createBird(img){
  return {
    x:80, y:H/2, vy:0,
    w: Math.min(40,img.width*0.4),
    h: Math.min(32,img.height*0.4),
    img, rotation:0,
    update(dt){
      this.vy += gravity * dt * 60;
      this.y += this.vy * dt * 60;
      this.rotation = Math.max(-0.6,Math.min(1.2,this.vy*0.06));
      if(this.y+this.h/2>=H){this.y=H-this.h/2; this.vy=0;}
      if(this.y-this.h/2<=0){this.y=this.h/2; this.vy=0;}
    },
    flap(){
      this.vy = flapStrength;
      playSound(flapSound);
    }
  };
}

function spawnPipe(x){
  const minGapCenter = pipeGap/2 + 80;
  const maxGapCenter = H - pipeGap/2 - 80;
  const gapY = Math.floor(Math.random()*(maxGapCenter-minGapCenter+1))+minGapCenter;
  return {
    x, gapY, passed:false,
    update(dt){ this.x -= pipeSpeed * dt * 60; },
    offScreen(){ return this.x + pipeWidth < 0; },
    draw(ctx){
      ctx.fillStyle='#2b6b6b';
      ctx.fillRect(this.x,0,pipeWidth,this.gapY-pipeGap/2);
      ctx.fillRect(this.x,this.gapY+pipeGap/2,pipeWidth,H-(this.gapY+pipeGap/2));
    }
  };
}

function checkCollision(b,p){
  const bx1=b.x-b.w/2,bx2=b.x+b.w/2;
  const by1=b.y-b.h/2,by2=b.y+b.h/2;
  const topY2=p.gapY-pipeGap/2, bottomY1=p.gapY+pipeGap/2;
  const px1=p.x, px2=p.x+pipeWidth;
  return (bx2>px1 && bx1<px2 && (by1<topY2||by2>bottomY1)) || by2>=H || by1<=0;
}

function clear(){ ctx.clearRect(0,0,W,H); }
function drawBackground(){ ctx.fillStyle='#6abf96'; ctx.fillRect(0,H-60,W,60); }
function drawBird(b){ ctx.save(); ctx.translate(b.x,b.y); ctx.rotate(b.rotation); ctx.drawImage(b.img,-b.w/2,-b.h/2,b.w,b.h); ctx.restore(); }

function update(dt){
  bird.update(dt);
  const now = Date.now();
  if(now - lastPipeTime > pipeInterval){
    pipes.push(spawnPipe(W+20));
    lastPipeTime = now;
  }

  for(let i=pipes.length-1;i>=0;i--){
    const p=pipes[i];
    p.update(dt);
    if(checkCollision(bird,p)) endGame();
    if(p.offScreen()) pipes.splice(i,1);
    else if(!p.passed && bird.x>p.x+pipeWidth){
      score++; scoreEl.textContent=score;
      p.passed=true;
    }
  }
}

function draw(){
  clear();
  drawBackground();
  pipes.forEach(p=>p.draw(ctx));
  drawBird(bird);
}

function loop(timestamp){
  if(!running) return;
  if(!lastFrameTime) lastFrameTime = timestamp;
  let dt = (timestamp - lastFrameTime)/16.6667;
  dt = Math.min(dt, 2); // cap delta
  lastFrameTime = timestamp;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

function startGame(){
  if(running) return; // lock
  if(!bird) return; // ensure bird loaded
  running=true;
  pipes=[]; score=0; scoreEl.textContent=score; lastPipeTime=Date.now(); lastFrameTime=0;
  bird.x=80; bird.y=H/2; bird.vy=0;
  for(let i=0;i<3;i++) pipes.push(spawnPipe(W+i*pipeWidth*5));
  msgBox.style.display='none';
  requestAnimationFrame(loop);
}

function endGame(){
  if(!running) return;
  running=false;
  playSound(hitSound);
  bestScore=Math.max(bestScore,score);
  msgText.innerHTML=`Game Over<br>Score: ${score}<br>Best: ${bestScore}`;
  msgBox.style.display='block';
}

function doFlap(){
  unlockSounds();
  if(!running) startGame();
  if(bird) bird.flap();
}

function playSound(audio){
  if(!soundsUnlocked) return;
  try { audio.currentTime=0; audio.play(); } catch(e){}
}

function unlockSounds(){
  if(soundsUnlocked) return;
  try { flapSound.play().then(()=>flapSound.pause()); } catch(e){}
  try { hitSound.play().then(()=>hitSound.pause()); } catch(e){}
  soundsUnlocked=true;
}

// Controls
window.addEventListener('keydown',e=>{if(e.code==='Space'){e.preventDefault();doFlap();}});
canvas.addEventListener('mousedown',doFlap);
window.addEventListener('touchstart',e=>{e.preventDefault();doFlap();},{passive:false});
startBtn.addEventListener('click',startGame);

// Load bird image safely
const birdImg = new Image();
birdImg.src = birdImageSrc;
birdImg.onload = () => {
  bird = createBird(birdImg);
  msgText.innerHTML='Tap anywhere / Space / Click to play';
  msgBox.style.display='block';
};
})();
</script>
</body>
</html>
